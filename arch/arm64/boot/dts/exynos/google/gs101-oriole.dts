// SPDX-License-Identifier: GPL-2.0-only
/*
 * Oriole Device Tree
 *
 * Copyright 2021-2023 Google LLC
 * Copyright 2023 Linaro Ltd - <peter.griffin@linaro.org>
 */

/dts-v1/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>
#include "gs101-pinctrl.h"
#include "gs101.dtsi"

/ {
	model = "Oriole";
	compatible = "google,gs101-oriole", "google,gs101";

	aliases {
		serial0 = &serial_0;
	};

	chosen {
		/* Bootloader expects bootargs specified otherwise it crashes */
		bootargs = "";
		stdout-path = &serial_0;
	};

	gpio-keys {
		compatible = "gpio-keys";
		pinctrl-0 = <&key_voldown>, <&key_volup>, <&key_power>;
		pinctrl-names = "default";

		button-vol-down {
			label = "KEY_VOLUMEDOWN";
			linux,code = <KEY_VOLUMEDOWN>;
			gpios = <&gpa7 3 GPIO_ACTIVE_LOW>;
			wakeup-source;
		};

		button-vol-up {
			label = "KEY_VOLUMEUP";
			linux,code = <KEY_VOLUMEUP>;
			gpios = <&gpa8 1 GPIO_ACTIVE_LOW>;
			wakeup-source;
		};

		button-power {
			label = "KEY_POWER";
			linux,code = <KEY_POWER>;
			gpios = <&gpa10 1 GPIO_ACTIVE_LOW>;
			wakeup-source;
		};
	};

	/* TODO: Remove this once PMIC is implemented  */
	reg_placeholder: regulator-0 {
		compatible = "regulator-fixed";
		regulator-name = "placeholder_reg";
	};

	/* TODO: Remove this once S2MPG11 slave PMIC is implemented  */
	ufs_0_fixed_vcc_reg: regulator-1 {
		compatible = "regulator-fixed";
		regulator-name = "ufs-vcc";
		gpio = <&gpp0 1 GPIO_ACTIVE_HIGH>;
		regulator-boot-on;
		enable-active-high;
	};
};

&ext_24_5m {
	clock-frequency = <24576000>;
};

&ext_200m {
	clock-frequency = <200000000>;
};

&hsi2c_8 {
	status = "okay";

	eeprom: eeprom@50 {
		compatible = "atmel,24c08";
		reg = <0x50>;
	};
};

&hsi2c_12 {
	status = "okay";
	/* TODO: add the devices once drivers exist */
};

&pinctrl_far_alive {
	key_voldown: key-voldown-pins {
		samsung,pins = "gpa7-3";
		samsung,pin-function = <GS101_PIN_FUNC_EINT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
		samsung,pin-drv = <GS101_PIN_DRV_2_5_MA>;
	};

	key_volup: key-volup-pins {
		samsung,pins = "gpa8-1";
		samsung,pin-function = <GS101_PIN_FUNC_EINT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
		samsung,pin-drv = <GS101_PIN_DRV_2_5_MA>;
	};

	cs35l41_l_irq: cs35l41-l-irq {
		samsung,pins = "gpa6-3"; /* XEINT_3 */
		samsung,pin-function = <GS101_PIN_FUNC_EINT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
	};

};

&pinctrl_gpio_alive {
	key_power: key-power-pins {
		samsung,pins = "gpa10-1";
		samsung,pin-function = <GS101_PIN_FUNC_EINT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
		samsung,pin-drv = <GS101_PIN_DRV_2_5_MA>;
	};
	
	cs35l41_r_irq: cs35l41-r-irq {
		samsung,pins = "gpa9-6"; /* XEINT_26 */
		samsung,pin-function = <GS101_PIN_FUNC_EINT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
	};
};

&serial_0 {
	status = "okay";
};

&ufs_0 {
	status = "okay";
	vcc-supply = <&ufs_0_fixed_vcc_reg>;
};

&ufs_0_phy {
	status = "okay";
};

&usbdrd31 {
	vdd10-supply = <&reg_placeholder>;
	vdd33-supply = <&reg_placeholder>;
	status = "okay";
};

&usbdrd31_dwc3 {
	dr_mode = "otg";
	usb-role-switch;
	role-switch-default-mode = "peripheral";
	maximum-speed = "super-speed-plus";
	status = "okay";
};

&usbdrd31_phy {
	/* TODO: Update these once PMIC is implemented */
	pll-supply = <&reg_placeholder>;
	dvdd-usb20-supply = <&reg_placeholder>;
	vddh-usb20-supply = <&reg_placeholder>;
	vdd33-usb20-supply = <&reg_placeholder>;
	vdda-usbdp-supply = <&reg_placeholder>;
	vddh-usbdp-supply = <&reg_placeholder>;
	status = "okay";
};

&usi_uart {
	samsung,clkreq-on; /* needed for UART mode */
	status = "okay";
};

&usi8 {
	samsung,mode = <USI_V2_I2C>;
	status = "okay";
};

&usi12 {
	samsung,mode = <USI_V2_I2C>;
	status = "okay";
};

&watchdog_cl0 {
	timeout-sec = <30>;
	status = "okay";
};


&pcie {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pcie1_clkreq &pcie_wlanen>;
	vdd10-supply = <&reg_placeholder>;
	vdd18-supply = <&reg_placeholder>;
	assigned-clocks = <&cmu_hsi2 CLK_MOUT_HSI2_PCIE_USER>,
			  <&cmu_top CLK_MOUT_CMU_HSI2_PCIE>;
	assigned-clock-rates = <0>, <100000000>;
	interrupt-map-mask = <0 0 0 0>;
	interrupt-map = <0 0 0 0 &gic 0 GIC_SPI 509 IRQ_TYPE_LEVEL_HIGH>;
};

&pcie_phy {
	status = "okay";
};

&pinctrl_peric0 {
	cs35l41_l_rst: cs35l41-l-rst {
		samsung,pins = "gpp16-3"; /* XAPC_USI8_CTSN_CSN */
		samsung,pin-function = <GS101_PIN_FUNC_OUTPUT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
		samsung,pin-con-pdn = <GS101_PIN_PDN_PREV>;
		samsung,pin-pud-pdn = <GS101_PIN_PULL_NONE>;
	};

	cs35l41_cs2: cs35l41-cs2 {
		samsung,pins = "gpp1-0"; /* XAPC_GPIO2 */
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
	};
};

&pinctrl_peric1 {
	cs35l41_r_rst: cs35l41-r-rst {
		samsung,pins = "gpp23-7"; /* XAPC_USI12_CTSN_CSN */
		samsung,pin-function = <GS101_PIN_FUNC_OUTPUT>;
		samsung,pin-pud = <GS101_PIN_PULL_NONE>;
		samsung,pin-con-pdn = <GS101_PIN_PDN_PREV>;
		samsung,pin-pud-pdn = <GS101_PIN_PULL_NONE>;
	};

	cs35l41_miso: cs35l41-miso {
		samsung,pins = "gpp25-2"; /* XAPC_USI13_RTSn_DI */
		samsung,pin-pud = <GS101_PIN_PULL_DOWN>;
	};

	cs35l41_mosi: cs35l41-mosi {
		samsung,pins = "gpp25-1"; /* XAPC_USI13_TXD_DO_SDA */
		samsung,pin-drv = <GS101_PIN_DRV_5_MA>;
	};

	cs35l41_clk: cs35l41-clk {
		samsung,pins = "gpp25-0"; /* XAPC_USI13_RXD_CLK_SCL */
		samsung,pin-drv = <GS101_PIN_DRV_5_MA>;
	};
};

&usi13 {
	samsung,mode = <USI_V2_SPI>;
	status = "okay";
};

&spi_13 {
	/* XAPC_USI13 */
	#address-cells = <1>;
	#size-cells = <0>;
	status = "okay";
	num-cs = <1>;

	pinctrl-names = "default";
	pinctrl-0 = <&spi13_bus &spi13_cs_func &cs35l41_cs2
		     &cs35l41_miso &cs35l41_mosi &cs35l41_clk>;
	cs-gpios = <&gpp25 3 GPIO_ACTIVE_HIGH>, <&gpp1 0 GPIO_ACTIVE_HIGH>;
	
	cs35l41_l: cs35l41@0 {
		#sound-dai-cells = <1>;
		compatible = "cirrus,cs35l41";
		spi-max-frequency = <25000000>;
		reg = <0>;

		status = "okay";

		pinctrl-names = "default";
		pinctrl-0 = <&cs35l41_l_irq &cs35l41_l_rst>;

		interrupt-parent = <&gpa6>;
		interrupts = <3 0 0>;

		reset-gpios = <&gpp16 3 0>;

		VA-supply = <&reg_placeholder>;
		VP-supply = <&reg_placeholder>;

		cirrus,boost-peak-milliamp = <3500>;
		cirrus,boost-ind-nanohenry = <1000>;
		cirrus,boost-cap-microfarad = <30>;

		cirrus,asp-sdout-hiz = <3>;
		cirrus,tuning-has-prefix;
		cirrus,left-channel-amp;
		cirrus,hw-noise-gate-select = <63>;
		cirrus,hibernate-enable;

		cirrus,gpio-config2 {
			cirrus,gpio-src-select = <0x5>;
			cirrus,gpio-output-enable;
		};

		controller-data {
			cs-gpio = <&gpp25 3 GPIO_ACTIVE_HIGH>;
			samsung,spi-feedback-delay = <1>;
			/* SET SPI CS CONTROL TO AUTOMATIC */
			samsung,spi-chip-select-mode = <1>;
		};
	};


	cs35l41_r: cs35l41@1 {
		#sound-dai-cells = <1>;
		sound-name-prefix = "R";
		compatible = "cirrus,cs35l41";
		spi-max-frequency = <25000000>;
		reg = <1>;

		status = "okay";

		pinctrl-names = "default";
		pinctrl-0 = <&cs35l41_r_irq &cs35l41_r_rst>;

		interrupt-parent = <&gpa9>;
		interrupts = <6 0 0>;

		reset-gpios = <&gpp23 7 0>;

		VA-supply = <&reg_placeholder>;
		VP-supply = <&reg_placeholder>;

		cirrus,boost-peak-milliamp = <3500>;
		cirrus,boost-ind-nanohenry = <1000>;
		cirrus,boost-cap-microfarad = <30>;

		cirrus,asp-sdout-hiz = <3>;
		cirrus,tuning-has-prefix;
		cirrus,left-channel-amp;
		cirrus,hw-noise-gate-select = <63>;
		cirrus,hibernate-enable;

		cirrus,gpio-config2 {
			cirrus,gpio-src-select = <0x5>;
			cirrus,gpio-output-enable;
		};

		controller-data {
			cs-gpio =<&gpp1 0 GPIO_ACTIVE_HIGH>;
			samsung,spi-feedback-delay = <1>;
			/* SET SPI CS CONTROL TO AUTOMATIC */
			samsung,spi-chip-select-mode = <1>;
		};
	};

};
